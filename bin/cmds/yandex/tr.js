'use strict';/* eslint max-len: 0, no-unused-vars: 0 */var themes=require('../../themes');var tools=require('../../tools');var _=require('lodash');var chalk=require('chalk');var fs=require('fs');var http=require('good-guy-http')();var noon=require('noon');var CFILE=process.env.HOME+'/.toloko.noon';exports.command='translate <query>';exports.aliases=['trans','tr'];exports.desc='Translate a word';exports.builder={out:{alias:'o',desc:'Write cson, json, noon, plist, yaml, xml',default:'',type:'string'},force:{alias:'f',desc:'Force overwriting outfile',default:false,type:'boolean'},save:{alias:'e',desc:'Save flags to config file',default:false,type:'boolean'},dir:{alias:'d',desc:"Translation direction. A single 2-letter ISO 639-1 language code (e.g. 'ru') or 2 codes separated by a hyphen (e.g. 'en-ru')",default:'',type:'string'}};exports.handler=function(argv){tools.checkConfig(CFILE);var config=noon.load(CFILE);var userConfig={dir:argv.d};if(config.merge)config=_.merge({},config,userConfig);if(argv.e&&config.merge)noon.save(CFILE,config);if(argv.e&&!config.merge)throw new Error("Can't save user config, set option merge to true.");var theme=themes.loadTheme(config.theme);themes.label(theme,'down','Powered by Yandex.Translate','http://translate.yandex.com/');var prefix='https://translate.yandex.net/api/v1.5/tr.json/translate?';var dcont=[];dcont.push(argv.query);if(argv._.length>1){_.each(argv._,function(value){if(value!=='yx'&&value!=='tr')dcont.push(value);});}var words='';if(dcont.length>1){words=dcont.join('+');}else{words=dcont[0];}var ucont=[];ucont.push('key='+process.env.YANDEX);ucont.push('text='+words);ucont.push('lang='+argv.d);ucont.push('format=plain');var url=''+prefix+ucont.join('&');url=encodeURI(url);var tofile={type:'yandex',function:'translate',src:'http://translate.yandex.com'};http({url:url},function(error,response){if(!error&&response.statusCode===200){var body=JSON.parse(response.body);themes.label(theme,'right','Translation direction',body.lang);tofile.lang=body.lang;for(var i=0;i<=body.text.length-1;i++){themes.label(theme,'right','Result',body.text[i]);tofile[['result'+i]]=body.text[i];}if(argv.o)tools.outFile(argv.o,argv.f,tofile);}else{throw new Error('HTTP '+error);}});};